
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 北海道冬の旅手帳 v5 ❄️</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sketch: {
                            bg: '#FFFBF5',        // 米白紙張
                            ink: '#5E4B35',       // 深咖啡墨水
                            snow: '#E3F2FD',      // 冰藍
                            warm: '#FFECB3',      // 暖黃
                            pink: '#FFCDD2',      // 腮紅粉
                            alert: '#FF7043',     // 重點紅
                            green: '#C8E6C9',     // 抹茶綠
                            line: '#D7CCC8',      // 淺棕線條
                            paper: '#FEFEFA'      // 純白紙
                        }
                    },
                    fontFamily: {
                        sans: ['"Zen Maru Gothic"', 'sans-serif'],
                    },
                    boxShadow: {
                        'sketch': '3px 4px 0px 0px #5E4B35',
                        'sketch-sm': '1px 2px 0px 0px #5E4B35',
                        'paper': '1px 1px 5px rgba(0,0,0,0.05)'
                    },
                    animation: {
                        'float': 'float 4s ease-in-out infinite',
                        'wiggle': 'wiggle 3s ease-in-out infinite',
                        'snow': 'snow 10s linear infinite',
                        'pulse-slow': 'pulse 3s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0) rotate(0deg)' },
                            '50%': { transform: 'translateY(-5px) rotate(2deg)' },
                        },
                        wiggle: {
                            '0%, 100%': { transform: 'rotate(-2deg)' },
                            '50%': { transform: 'rotate(2deg)' },
                        },
                        snow: {
                            '0%': { transform: 'translateY(-10px) translateX(0)', opacity: '0' },
                            '20%': { opacity: '1' },
                            '100%': { transform: 'translateY(100vh) translateX(20px)', opacity: '0.2' }
                        },
                        pulse: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.05)' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #FFFBF5;
            background-image: radial-gradient(#D7CCC8 1px, transparent 1px), radial-gradient(#D7CCC8 1px, transparent 1px);
            background-position: 0 0, 25px 25px;
            background-size: 50px 50px;
            color: #5E4B35;
            -webkit-tap-highlight-color: transparent;
            overflow: hidden;
        }

        /* 雪花背景 */
        .snow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .snowflake {
            position: absolute;
            color: #E3F2FD;
            font-size: 1.5rem;
            opacity: 0.8;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .tab-content {
            display: none;
            animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            padding-bottom: 120px;
        }

            .tab-content.active {
                display: block;
            }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(10px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* 手繪邊框效果 */
        .sketch-box {
            border: 2px solid #5E4B35;
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
            background: white;
        }

        .sketch-box-fill {
            border: 2px solid #5E4B35;
            border-radius: 255px 15px 225px 15px / 15px 225px 15px 255px;
        }

        /* 膠帶效果 */
        .washi-tape {
            position: absolute;
            height: 30px;
            width: 100px;
            background-color: rgba(255, 205, 210, 0.6);
            transform: rotate(-3deg);
            z-index: 10;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            left: 50%;
            top: -15px;
            margin-left: -50px;
            border-left: 2px dotted rgba(255,255,255,0.5);
            border-right: 2px dotted rgba(255,255,255,0.5);
        }

        /* 時間軸線 */
        .timeline-line {
            position: absolute;
            left: 26px;
            top: 20px;
            bottom: 0;
            width: 4px;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='0' ry='0' stroke='%23D7CCC8' stroke-width='4' stroke-dasharray='10%2c 10' stroke-dashoffset='0' stroke-linecap='round'/%3e%3c/svg%3e");
            background-repeat: repeat-y;
            z-index: 0;
        }

        .nav-item.active {
            color: #5E4B35;
            transform: translateY(-5px) rotate(-3deg);
        }

            .nav-item.active .icon-circle {
                background-color: #FFCDD2;
                border: 2px solid #5E4B35;
                box-shadow: 2px 2px 0 #5E4B35;
            }

        /* 展開動畫 */
        .event-details {
            max-height: 0;
            overflow: hidden;
            transition: all 0.4s ease-in-out;
            opacity: 0;
        }

        .expanded .event-details {
            max-height: 1000px;
            opacity: 1;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px dashed #D7CCC8;
        }

        .expand-icon {
            transition: transform 0.3s;
        }

        .expanded .expand-icon {
            transform: rotate(180deg);
        }

        /* 重要時間標示 */
        .important-badge {
            background: #FF7043;
            color: white;
            padding: 2px 8px;
            border-radius: 12px 2px 12px 2px;
            font-size: 0.7rem;
            font-weight: 900;
            border: 1px solid #5E4B35;
            box-shadow: 1px 1px 0 #5E4B35;
            animation: pulse 2s infinite;
        }

        /* 筆記本線條背景 */
        .lined-paper {
            background-image: repeating-linear-gradient(transparent, transparent 27px, #E0F7FA 28px);
            background-color: #FEFEFA;
            line-height: 28px;
        }
    </style>
</head>
<body class="font-sans h-screen flex flex-col relative text-sketch-ink">

    <!-- 雪花特效 -->
    <div class="snow-container">
        <div class="snowflake" style="left: 10%; animation-delay: 0s;">❄</div>
        <div class="snowflake" style="left: 30%; animation-delay: 2s; font-size: 1rem;">❅</div>
        <div class="snowflake" style="left: 50%; animation-delay: 4s;">❄</div>
        <div class="snowflake" style="left: 70%; animation-delay: 1s; font-size: 0.8rem;">❅</div>
        <div class="snowflake" style="left: 90%; animation-delay: 3s;">❄</div>
    </div>

    <!-- 裝飾 -->
    <div class="fixed top-12 -right-4 z-0 opacity-20 transform rotate-12 pointer-events-none">
        <i class="fas fa-mountain text-9xl text-sketch-snow"></i>
    </div>

    <!-- Header -->
    <header class="bg-white/90 backdrop-blur-sm z-20 px-4 py-3 flex justify-between items-center shrink-0 mx-2 mt-2 relative sketch-box shadow-sketch">
        <!-- 紙膠帶 -->
        <div class="washi-tape" style="top: -12px; background-color: rgba(160, 216, 239, 0.6);"></div>

        <div>
            <h1 class="text-xl font-black text-sketch-ink tracking-wider flex items-center gap-2">
                <span class="bg-sketch-pink w-8 h-8 rounded-full flex items-center justify-center border border-sketch-ink text-white">冬</span>
                北海道手帳
            </h1>
            <div class="flex items-center gap-2 mt-1 ml-1">
                <span class="text-xs font-bold text-sketch-ink/60 bg-sketch-snow px-2 py-0.5 rounded-sm transform -rotate-1">2025.12.20 - 12.26</span>
            </div>
        </div>
        <div class="text-right">
            <div class="w-10 h-10 flex items-center justify-center animate-wiggle bg-sketch-warm rounded-full border-2 border-sketch-ink">
                <span class="text-2xl">⛄</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto hide-scrollbar relative p-2 z-10">

        <!-- PLAN TAB -->
        <div id="tab-plan" class="tab-content active">
            <!-- Date Selector (Sticky) -->
            <div id="date-scroll" class="flex overflow-x-auto gap-3 pb-2 mb-4 hide-scrollbar sticky top-0 z-20 py-3 px-1 -mx-2 px-3 bg-gradient-to-b from-sketch-bg via-sketch-bg to-transparent">
                <!-- JS Generated -->
            </div>

            <div id="itinerary-container" class="space-y-6 relative pl-2 pr-2 mt-2 pb-8">
                <!-- JS Generated Timeline -->
            </div>

            <div class="text-center mt-8 mb-4">
                <div class="inline-block bg-white border-2 border-sketch-ink px-4 py-2 rounded-full shadow-sketch text-xs font-bold transform -rotate-1">
                    <i class="fas fa-hand-pointer mr-1 text-sketch-alert"></i> 點擊卡片看詳細 & 地圖喔！
                </div>
            </div>
        </div>

        <!-- GUIDE TAB -->
        <div id="tab-guide" class="tab-content">
            <div class="text-center mb-8 mt-4 relative">
                <span class="absolute -top-6 -left-2 text-4xl transform -rotate-12 opacity-50">📖</span>
                <h2 class="inline-block relative z-10 bg-white px-6 py-2 sketch-box text-sketch-ink font-black text-lg transform rotate-1">
                    <i class="fas fa-feather-alt mr-2 text-sketch-green"></i>旅行筆記．豆知識
                </h2>
            </div>
            <div id="guide-container" class="grid grid-cols-1 gap-6 px-1">
                <!-- JS Generated -->
            </div>
        </div>

        <!-- WALLET TAB -->
        <div id="tab-wallet" class="tab-content">
            <!-- Calculator -->
            <div class="sketch-box p-5 mb-6 mx-1 mt-2 relative bg-white">
                <div class="washi-tape" style="top: -10px; right: 20px; left: auto; background-color: rgba(255, 236, 179, 0.7); width: 60px;"></div>

                <div class="flex justify-between items-center mb-4">
                    <label class="text-sm font-bold flex items-center gap-2">
                        <div class="w-6 h-6 bg-sketch-green rounded-full border border-sketch-ink flex items-center justify-center text-xs text-white">￥</div>
                        即時匯率
                    </label>
                    <input type="number" id="exchange-rate" value="0.201" step="0.001" class="w-20 text-center text-lg font-bold bg-sketch-bg border-b-2 border-sketch-ink border-dashed focus:outline-none">
                </div>

                <div class="bg-sketch-snow/30 rounded-lg p-3 mb-4 border-2 border-sketch-ink relative">
                    <input type="text" id="calc-input" placeholder="輸入算式..." class="w-full bg-transparent text-xl text-right focus:outline-none mb-1 font-black text-sketch-ink font-mono">
                    <div class="flex justify-between items-end border-t-2 border-dashed border-sketch-line pt-2">
                        <span class="text-xs text-sketch-ink/60 font-bold">JPY</span>
                        <span id="calc-result-jpy" class="text-xl font-bold text-sketch-ink">0</span>
                    </div>
                    <div class="flex justify-between items-end mt-1">
                        <span class="text-xs text-sketch-ink/60 font-bold">約 TWD</span>
                        <span id="calc-result-twd" class="text-lg font-bold text-sketch-alert">0</span>
                    </div>
                </div>

                <div class="grid grid-cols-4 gap-2 mb-4">
                    <button onclick="appendCalc('+')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">+</button>
                    <button onclick="appendCalc('-')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">-</button>
                    <button onclick="appendCalc('*')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">×</button>
                    <button onclick="calculate()" class="bg-sketch-pink h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-white">=</button>
                </div>

                <div class="grid grid-cols-4 gap-2 mb-4">
                    <button onclick="appendCalc('1')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">1</button>
                    <button onclick="appendCalc('2')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">2</button>
                    <button onclick="appendCalc('3')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">3</button>
                    <button onclick="appendCalc('/')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">÷</button>

                    <button onclick="appendCalc('4')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">4</button>
                    <button onclick="appendCalc('5')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">5</button>
                    <button onclick="appendCalc('6')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">6</button>
                    <button onclick="clearCalc()" class="bg-sketch-alert text-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">C</button>

                    <button onclick="appendCalc('7')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">7</button>
                    <button onclick="appendCalc('8')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">8</button>
                    <button onclick="appendCalc('9')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">9</button>
                    <button onclick="appendCalc('0')" class="bg-white h-10 sketch-box shadow-sm active:translate-y-1 active:shadow-none font-bold text-lg">0</button>
                </div>

                <div class="border-t-2 border-dashed border-sketch-line pt-4 flex gap-2">
                    <input type="text" id="expense-item" placeholder="買了什麼..." class="flex-1 bg-transparent border-b-2 border-sketch-ink border-dashed px-2 text-sm font-bold outline-none">
                    <label class="sketch-box w-10 h-10 flex items-center justify-center bg-sketch-warm cursor-pointer active:scale-95">
                        <i class="fas fa-camera"></i>
                        <input type="file" id="expense-photo" accept="image/*" capture="environment" class="hidden" onchange="handlePhotoUpload(this)">
                    </label>
                </div>

                <div id="photo-preview-container" class="hidden mt-3 relative w-full h-32 sketch-box p-1 rotate-1">
                    <img id="photo-preview" class="w-full h-full object-contain">
                    <button onclick="clearPhoto()" class="absolute -top-2 -right-2 bg-sketch-alert text-white w-6 h-6 rounded-full border-2 border-sketch-ink flex items-center justify-center font-bold">×</button>
                </div>

                <button onclick="addExpense()" class="w-full bg-sketch-ink text-white py-3 sketch-box-fill shadow-sketch mt-4 font-bold active:translate-y-1 active:shadow-none">
                    <i class="fas fa-pen-nib mr-2"></i>記下來
                </button>
            </div>

            <!-- List -->
            <div class="px-2">
                <div class="flex justify-between items-center mb-3 border-b-2 border-sketch-ink pb-1">
                    <h3 class="font-bold text-lg"><i class="fas fa-receipt mr-2"></i>支出紀錄</h3>
                    <span class="text-xs font-bold bg-white px-2 py-1 sketch-box text-sketch-ink">Total: ¥<span id="total-jpy">0</span></span>
                </div>
                <ul id="expense-list" class="space-y-3 pb-4">
                    <!-- JS Generated -->
                </ul>
                <button onclick="clearExpenses()" class="w-full text-center text-xs text-sketch-ink/50 mt-4 underline decoration-wavy">🗑️ 換一本新帳本 (清空)</button>
            </div>
        </div>

        <!-- LISTS TAB -->
        <div id="tab-lists" class="tab-content px-1">
            <!-- Checklist -->
            <div class="sketch-box p-5 mb-6 mt-2 relative bg-white rotate-1">
                <div class="washi-tape" style="left: 20%; background-color: rgba(168, 216, 185, 0.6);"></div>
                <h3 class="text-lg font-black mb-4 flex items-center gap-2 border-b-2 border-dashed border-sketch-line pb-2">
                    <i class="fas fa-check-square text-sketch-green"></i> 行李檢查表
                </h3>
                <div id="checklist-container" class="space-y-2">
                    <!-- JS Generated -->
                </div>
                <div class="mt-4 flex gap-2">
                    <input type="text" id="new-todo" placeholder="還要帶..." class="flex-1 bg-sketch-bg border-b-2 border-sketch-ink px-2 text-sm font-bold outline-none">
                    <button onclick="addTodo()" class="bg-sketch-ink text-white w-8 h-8 rounded-full border-2 border-sketch-ink flex items-center justify-center"><i class="fas fa-plus text-xs"></i></button>
                </div>
            </div>

            <!-- Memo -->
            <div class="sketch-box p-5 bg-[#FFF9C4] -rotate-1 relative">
                <div class="absolute -top-3 -right-2 text-2xl transform rotate-12">📝</div>
                <h3 class="text-lg font-black mb-2 flex items-center gap-2">
                    隨手記
                </h3>
                <textarea id="memo-area" class="w-full h-40 bg-transparent p-2 text-sm leading-loose outline-none resize-none font-bold text-sketch-ink placeholder-sketch-ink/40" style="background-image: repeating-linear-gradient(transparent, transparent 31px, #D7CCC8 31px, #D7CCC8 32px); line-height: 32px;" placeholder="輸入網址會自動變成連結喔..."></textarea>
            </div>
        </div>

        <!-- INFO TAB -->
        <div id="tab-info" class="tab-content px-2 space-y-6 pt-2">

            <div class="sketch-box p-5 relative overflow-hidden bg-white">
                <div class="absolute -right-6 -top-6 text-sketch-snow text-9xl opacity-80"><i class="fas fa-snowflake"></i></div>
                <h3 class="font-black text-lg mb-2 text-sketch-ink relative z-10"><i class="fas fa-temperature-low mr-2 text-blue-400"></i>北海道天氣</h3>
                <p class="text-sm text-sketch-ink mb-4 font-bold relative z-10">12月平均 -4°C ~ -1°C <br> 洋蔥式穿搭最重要！室內暖氣很強。</p>
                <a href="https://www.jma.go.jp/bosai/forecast/" target="_blank" class="inline-block bg-sketch-ink text-white text-xs font-bold px-4 py-2 rounded-full shadow-md hover:bg-sketch-ink/80 transition relative z-10"><i class="fas fa-external-link-alt mr-1"></i> 日本氣象廳</a>
            </div>

            <div class="sketch-box p-5 bg-[#FFEBEE] border-sketch-pink relative">
                <div class="absolute -left-2 -top-3 text-3xl transform -rotate-12">🚑</div>
                <h3 class="font-black text-lg mb-3 pl-8">緊急聯絡</h3>
                <ul class="space-y-3 text-sm text-sketch-ink font-bold">
                    <li class="flex items-center gap-3"><span class="bg-white border-2 border-sketch-ink w-8 h-8 rounded-full flex items-center justify-center text-sketch-alert"><i class="fas fa-phone"></i></span> 警察局: 110</li>
                    <li class="flex items-center gap-3"><span class="bg-white border-2 border-sketch-ink w-8 h-8 rounded-full flex items-center justify-center text-sketch-alert"><i class="fas fa-ambulance"></i></span> 救護車: 119</li>
                    <li class="bg-white p-3 rounded-lg border-2 border-sketch-ink border-dashed mt-2">
                        <div class="mb-1 text-[10px] text-gray-500">台北駐日經濟文化代表處札幌分處</div>
                        <a href="tel:+81112222930" class="text-lg font-black flex items-center gap-2 text-sketch-alert"><i class="fas fa-phone-square-alt"></i> +81-11-222-2930</a>
                    </li>
                </ul>
            </div>
        </div>

    </main>

    <!-- Bottom Navigation -->
    <nav class="bg-white/90 backdrop-blur-md border-t-2 border-sketch-ink shrink-0 pb-safe z-30 relative" style="border-radius: 25px 25px 0 0; box-shadow: 0 -4px 10px rgba(0,0,0,0.05);">
        <div class="flex justify-around items-center h-20">
            <button class="nav-item active flex flex-col items-center justify-center w-full h-full transition-all duration-300 group" onclick="switchTab('plan', this)">
                <div class="icon-circle w-10 h-10 rounded-full flex items-center justify-center mb-1 transition-all group-hover:bg-sketch-snow">
                    <i class="fas fa-map-marked-alt text-lg"></i>
                </div>
                <span class="text-[10px] font-bold">行程</span>
            </button>
            <button class="nav-item flex flex-col items-center justify-center w-full h-full transition-all duration-300 group" onclick="switchTab('guide', this)">
                <div class="icon-circle w-10 h-10 rounded-full flex items-center justify-center mb-1 transition-all group-hover:bg-sketch-snow">
                    <i class="fas fa-book-reader text-lg"></i>
                </div>
                <span class="text-[10px] font-bold">導覽</span>
            </button>
            <button class="nav-item flex flex-col items-center justify-center w-full h-full transition-all duration-300 group" onclick="switchTab('wallet', this)">
                <div class="icon-circle w-12 h-12 bg-sketch-pink border-2 border-sketch-ink rounded-full flex items-center justify-center mb-1 shadow-sm -mt-6 transform transition group-hover:scale-110 text-white">
                    <i class="fas fa-wallet text-xl"></i>
                </div>
                <span class="text-[10px] font-bold mt-1">錢包</span>
            </button>
            <button class="nav-item flex flex-col items-center justify-center w-full h-full transition-all duration-300 group" onclick="switchTab('lists', this)">
                <div class="icon-circle w-10 h-10 rounded-full flex items-center justify-center mb-1 transition-all group-hover:bg-sketch-snow">
                    <i class="fas fa-list-check text-lg"></i>
                </div>
                <span class="text-[10px] font-bold">清單</span>
            </button>
            <button class="nav-item flex flex-col items-center justify-center w-full h-full transition-all duration-300 group" onclick="switchTab('info', this)">
                <div class="icon-circle w-10 h-10 rounded-full flex items-center justify-center mb-1 transition-all group-hover:bg-sketch-snow">
                    <i class="fas fa-info text-lg"></i>
                </div>
                <span class="text-[10px] font-bold">資訊</span>
            </button>
        </div>
    </nav>

    <script>
        // --- Enhanced Data ---
        const itineraryData = [
            {
                date: "12/20",
                day: "六",
                title: "出發！前進雪國 ✈️",
                active: true,
                events: [
                    {
                        time: "09:10",
                        desc: "務必抵達機場 (T1)",
                        type: "transport",
                        note: "提早 3 小時!",
                        highlight: true,
                        details: "請於09:10前抵達桃園機場第一航廈。酷航櫃台通常人多，建議提早報到。記得先填好 Visit Japan Web。"
                    },
                    {
                        time: "12:10",
                        desc: "酷航 TR892 起飛",
                        type: "transport",
                        note: "飛行約 4hr",
                        details: "12:10 起飛，預計 17:20 抵達新千歲機場 (CTS)。機上無供餐，建議自備輕食或上機前吃飽。"
                    },
                    { time: "17:50", desc: "抵達新千歲", type: "transport", details: "入境後，搭乘 JR 快速 Airport (¥1,150) 或 巴士 (¥1,300) 前往札幌。外面很冷，記得穿外套！" },
                    {
                        time: "19:00",
                        desc: "Check-in: Hotel Vista",
                        type: "stay",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Hotel+Vista+Sapporo+Odori",
                        details: "地點方便，就在狸小路商店街後面，有屋簷遮雪。"
                    },
                    {
                        time: "19:30",
                        desc: "晚餐：湯咖哩 🍛",
                        type: "food",
                        note: "Suage+ / GARAKU",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Suage+Plus+Sapporo",
                        reviewLink: "https://www.google.com/search?q=Suage%2B+%E6%9C%AD%E5%B9%8C+%E9%A3%9F%E8%A8%98",
                        details: "北海道必吃！推薦飯店附近的 Suage+ (串燒湯咖哩) 或 GARAKU。記得飯要泡進湯裡吃喔。"
                    },
                    {
                        time: "20:30",
                        desc: "夜間聖代 & 唐吉軻德",
                        type: "activity",
                        details: "體驗札幌「收尾聖代」文化。推薦：夜パフェ専門店ななかま堂。之後去逛24H唐吉軻德。"
                    }
                ]
            },
            {
                date: "12/21",
                day: "日",
                title: "札幌市區巡禮 ⛩️",
                active: false,
                events: [
                    {
                        time: "08:30",
                        desc: "諏訪神社 (買御守)",
                        type: "spot",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Sapporo+Suwa+Shrine",
                        details: "北13条東駅下車。必買超可愛的「銀喉長尾山雀」御守！"
                    },
                    {
                        time: "09:30",
                        desc: "北海道大學",
                        type: "spot",
                        details: "漫步校園。必去 Marche Café & Labo 吃農場冰淇淋和布丁。"
                    },
                    {
                        time: "12:00",
                        desc: "叙々苑燒肉午餐 🔥",
                        type: "food",
                        highlight: true,
                        note: "預約 12:00",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Jojoen+Sapporo",
                        details: "高級燒肉午間套餐 CP 值很高！札幌站前店。"
                    },
                    { time: "13:30", desc: "市區散步", type: "walk", details: "紅磚廳舍、時計台、六花亭札幌本店 (買伴手禮)。" },
                    { time: "17:00", desc: "COCONO SUSUKINO", type: "shop", note: "晚餐：根室花丸", details: "薄野新地標。B1 根室花丸壽司記得先抽號碼牌！" },
                    { time: "19:00", desc: "聖誕市集 & 電視塔", type: "spot", details: "大通公園慕尼黑聖誕市集，感受節慶氣氛。上電視塔看夜景。" }
                ]
            },
            {
                date: "12/22",
                day: "一",
                title: "登別洞爺一日遊 🚌",
                active: false,
                events: [
                    {
                        time: "07:40",
                        desc: "集合：大通公園",
                        type: "transport",
                        highlight: true,
                        note: "KKday 巴士",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Odori+Park+West+3",
                        details: "大通公園西3丁目（31號出口）。08:00 準時發車，遲到不等人的喔！"
                    },
                    { time: "09:50", desc: "登別地獄谷 ♨️", type: "spot", details: "火山地形，煙霧繚繞。走路小心地滑。" },
                    { time: "11:50", desc: "昭和新山 & 熊牧場 🐻", type: "spot", details: "可以餵熊吃蘋果。午餐自理。" },
                    { time: "13:40", desc: "洞爺湖", type: "spot", details: "選擇：日歸溫泉 或 遊覽船。欣賞湖光山色。" },
                    { time: "19:00", desc: "JR塔夜景 (T38)", type: "spot", details: "回到札幌站。晚餐後上 T38 展望台看夜景。" }
                ]
            },
            {
                date: "12/23",
                day: "二",
                title: "旭川美瑛夢幻遊 🐧",
                active: false,
                events: [
                    {
                        time: "07:50",
                        desc: "集合：札幌北口",
                        type: "transport",
                        highlight: true,
                        note: "KKday 巴士",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Sapporo+Station+North+Exit",
                        details: "札幌站北口巴士停車場。車程較長，建議帶頸枕。"
                    },
                    { time: "10:30", desc: "旭山動物園", type: "spot", details: "必看：11:00 企鵝散步！還有北極熊和海豹。" },
                    { time: "13:10", desc: "美瑛青池 & 瀑布", type: "spot", details: "冬季結冰點燈的青池，非常夢幻。" },
                    { time: "15:00", desc: "精靈露台", type: "spot", details: "富良野森林裡的小木屋，像童話世界一樣。" },
                    { time: "19:30", desc: "帝王蟹火鍋 🦀", type: "food", highlight: true, note: "蟹座吃到飽", details: "預約 19:30。大口吃螃蟹的時間到了！" }
                ]
            },
            {
                date: "12/24",
                day: "三",
                title: "白色聖誕夜 🎄",
                active: false,
                events: [
                    { time: "08:30", desc: "羊之丘展望台 🐑", type: "activity", details: "免費體驗玩雪 (滑步車、做雪人)。必拍克拉克博士像。" },
                    { time: "12:00", desc: "拉麵橫丁午餐", type: "food", details: "推薦：弟子屈拉麵 (魚介)、倍煎舍 (味噌)。" },
                    { time: "14:00", desc: "北海道神宮", type: "spot", note: "六花亭判官大人", details: "神宮限定的現烤麻糬，熱呼呼超好吃。" },
                    {
                        time: "16:00",
                        desc: "白色戀人公園",
                        type: "spot",
                        note: "聖誕點燈",
                        mapLink: "https://www.google.com/maps/search/?api=1&query=Shiroi+Koibito+Park",
                        details: "歐風庭園非常漂亮，16:00 後有點燈活動。"
                    },
                    { time: "18:30", desc: "聖誕晚餐：爐端燒", type: "food", highlight: true, note: "預約 Kakureya", details: "日式爐端燒，氣氛滿分。" },
                    { time: "20:30", desc: "AOAO 水族館 🐠", type: "spot", details: "moyuk 商場內。可以看到跳岩企鵝。" }
                ]
            },
            {
                date: "12/25",
                day: "四",
                title: "小樽浪漫漫步 🕯️",
                active: false,
                events: [
                    { time: "09:10", desc: "前往小樽", type: "transport", details: "搭乘 JR 快速 Airport 號 (坐右邊看海)。" },
                    { time: "10:00", desc: "小樽運河 & 商店街", type: "walk", details: "北菓樓泡芙、LeTAO 蛋糕、六花亭、音樂盒堂。" },
                    { time: "12:00", desc: "午餐：若雞時代", type: "food", details: "必吃炸半雞定食！皮脆多汁。" },
                    { time: "16:00", desc: "藻岩山夜景", type: "spot", note: "看天氣", details: "天氣好搭纜車看夜景 (新日本三大夜景)。天氣不好去啤酒博物館。" },
                    { time: "19:00", desc: "市區最後採買", type: "shop", details: "把日幣花光光！" }
                ]
            },
            {
                date: "12/26",
                day: "五",
                title: "再見北海道 👋",
                active: false,
                events: [
                    {
                        time: "08:30",
                        desc: "前往機場",
                        type: "transport",
                        details: "退房後搭巴士或 JR 前往新千歲機場。建議最晚12:20要到機場櫃台，早點去還可以逛機場商店街(超好逛！)。"
                    },
                    { time: "10:50", desc: "機場最後一逛", type: "shop", details: "國內線航廈超好逛！哆啦A夢空中樂園、Royce 巧克力。" },
                    { time: "12:00", desc: "午餐：一幻拉麵", type: "food", details: "拉麵道場內，超濃郁蝦湯。" },
                    {
                        time: "15:20",
                        desc: "長榮 BR115 起飛",
                        type: "transport",
                        highlight: true,
                        note: "19:05 抵達台北",
                        details: "15:20 起飛，帶著滿滿的戰利品與回憶，平安回家。"
                    }
                ]
            }
        ];

        const guideData = [
            {
                title: "白い恋人パーク (白色戀人公園)",
                content: "這裡不只是賣餅乾的地方，更像一座雪國童話城堡！除了參觀「白色戀人」的生產線，還可以體驗親手製作愛心餅乾。冬季庭園會有盛大的點燈活動，璀璨燈光映照在歐式建築與厚厚白雪上，超級浪漫！一定要在戶外的愛心拱門拍照打卡喔！\n\n★ 歷史小知識：白色戀人的靈感來自創辦人滑雪歸來時，隨口說出「白色戀人們降臨了」。",
                tags: ["浪漫", "必去", "拍照"]
            },
            {
                title: "旭山動物園のペンギン散歩",
                content: "冬季限定的超人氣活動！這其實是為了幫國王企鵝們解決冬季運動不足的問題。看著牠們搖搖晃晃地走在雪道上，真的會被萌翻！除了企鵝，別忘了去**海豹館**看垂直圓柱水槽，海豹會像火箭一樣咻咻咻地游過去喔！",
                tags: ["動物", "旭川", "限定"]
            },
            {
                title: "小樽運河 (Otaru Canal)",
                content: "這條運河建於 1923 年，曾是北海道金融經濟中心，被稱為「北方的華爾街」。運河旁的紅磚倉庫現在都改建成了餐廳和商店。黃昏時分，煤氣燈亮起，倒映在河面上，是小樽最浪漫的時刻。\n\n★ 拍照撇步：站在「淺草橋」上可以拍到運河最經典的弧線喔！",
                tags: ["歷史", "夜景", "浪漫"]
            },
            {
                title: "Shime Parfait (收尾聖代)",
                content: "在札幌，大家聚餐喝酒後，不是吃拉麵，而是吃「聖代」來做結尾！這叫做「締めパフェ」。這些夜間聖代通常做得像藝術品一樣精緻，口味上會運用利口酒、開心果、北海道乳製品，口感層次豐富，是大人的甜點。",
                tags: ["美食", "文化", "札幌限定"]
            },
            {
                title: "登別地獄谷 (Noboribetsu Jigokudani)",
                content: "這是約一萬年前火山爆發後形成的火山口遺跡，直徑約450公尺。這裡每天湧出1萬噸的溫泉水，是登別溫泉的源頭。因為不斷冒出白色煙霧和強烈的硫磺味，讓人聯想到地獄，所以被稱為「地獄谷」。",
                tags: ["自然", "溫泉", "壯觀"]
            },
            {
                title: "森林精靈露台 (Ningle Terrace)",
                content: "位於新富良野王子飯店旁的森林手工藝村。「Ningle」在北海道原住民愛努語中是「住在森林裡的小矮人」的意思。一間間木屋散落在森林中，當夜幕低垂點燈後，真的就像精靈居住的夢幻國度。",
                tags: ["富良野", "夢幻", "手作"]
            },
            {
                title: "札幌電視塔 (Sapporo TV Tower)",
                content: "建於1957年，位於大通公園東側，是札幌的地標。高147.2公尺，從90公尺高的展望台可以俯瞰整個大通公園，特別是冬季雪祭或聖誕點燈時，景色絕美。據說在展望台的「怖窗」(傾斜窗)往下看，會讓人腳底發癢喔！",
                tags: ["地標", "夜景", "歷史"]
            }
        ];

        // --- Logic ---
        let expenses = JSON.parse(localStorage.getItem('expenses_book_2025')) || [];
        let todoList = JSON.parse(localStorage.getItem('todo_book_2025')) || [
            { text: "護照 (效期6個月以上) 📕", done: false },
            { text: "Visit Japan Web 截圖 📱", done: false },
            { text: "eSIM 設定完成 📶", done: false },
            { text: "日幣現金 & 信用卡 💴", done: false },
            { text: "旅遊保險單 📄", done: false },
            { text: "防滑雪靴 & 手套 🧤", done: false }
        ];

        window.onload = function() {
            renderPlanTabs();
            renderTimeline(0);
            renderGuide();
            renderExpenses();
            renderTodoList();

            document.getElementById('exchange-rate').addEventListener('input', function(e){
                calculate();
            });
            document.getElementById('calc-input').addEventListener('input', calculate);
        };

        // Navigation
        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');
        }

        // Plan Logic
        function renderPlanTabs() {
            const container = document.getElementById('date-scroll');
            container.innerHTML = '';
            itineraryData.forEach((item, index) => {
                const btn = document.createElement('button');
                const isActive = index === 0;
                btn.className = `flex-shrink-0 w-16 py-2 text-center transition-all border-2 rounded-xl relative overflow-hidden group ${isActive ? 'bg-sketch-pink border-sketch-ink text-sketch-ink shadow-sketch transform -translate-y-1' : 'bg-white border-sketch-line text-gray-400'}`;
                btn.innerHTML = `
                    <span class="block text-[10px] font-bold mb-0">${item.date}</span>
                    <span class="text-lg font-black">${item.day}</span>
                `;
                btn.onclick = () => {
                    Array.from(container.children).forEach(c => {
                        c.className = 'flex-shrink-0 w-16 py-2 text-center transition-all border-2 bg-white border-sketch-line text-gray-400 rounded-xl';
                    });
                    btn.className = 'flex-shrink-0 w-16 py-2 text-center transition-all border-2 rounded-xl relative overflow-hidden group bg-sketch-pink border-sketch-ink text-sketch-ink shadow-sketch transform -translate-y-1';
                    renderTimeline(index);
                };
                container.appendChild(btn);
            });
        }

        function renderTimeline(index) {
            const dayData = itineraryData[index];
            const container = document.getElementById('itinerary-container');

            let html = `<div class="timeline-line"></div>`;
            html += `
                <div class="mb-8 ml-10 relative">
                    <h3 class="text-xl font-black text-sketch-ink bg-sketch-warm inline-block px-4 py-2 sketch-box transform -rotate-1">
                        ${dayData.title}
                    </h3>
                </div>
            `;

            dayData.events.forEach((event, idx) => {
                const hasDetails = event.details ? true : false;
                const eventId = `event-${idx}`;

                let iconClass = 'fa-circle';
                let iconBg = 'bg-white';

                if(event.type === 'transport') { iconClass = 'fa-train'; iconBg = 'bg-sketch-snow'; }
                else if(event.type === 'food') { iconClass = 'fa-utensils'; iconBg = 'bg-sketch-warm'; }
                else if(event.type === 'stay') { iconClass = 'fa-bed'; iconBg = 'bg-sketch-pink'; }
                else if(event.type === 'spot') { iconClass = 'fa-camera'; iconBg = 'bg-sketch-green'; }

                html += `
                <div class="relative pl-10 pb-6 group z-10">
                    <!-- Icon -->
                    <div class="absolute left-[18px] top-0 w-8 h-8 ${iconBg} border-2 border-sketch-ink rounded-full flex items-center justify-center z-20 shadow-sm">
                        <i class="fas ${iconClass} text-sketch-ink text-xs"></i>
                    </div>

                    <!-- Card -->
                    <div class="sketch-box p-4 bg-white relative cursor-pointer active:scale-[0.98] transition-transform"
                         onclick="${hasDetails ? `toggleDetails('${eventId}', this)` : ''}">

                        ${event.highlight ? '<div class="absolute -top-3 -right-2 important-badge transform rotate-3">重要!</div>' : ''}

                        <div class="flex justify-between items-start mb-2">
                            <span class="inline-block bg-gray-100 text-sketch-ink text-xs font-bold px-2 py-1 rounded border border-sketch-line">${event.time}</span>
                            ${hasDetails ? '<i class="fas fa-chevron-down text-gray-400 expand-icon"></i>' : ''}
                        </div>

                        <h4 class="text-base font-black text-sketch-ink">${event.desc}</h4>

                        ${hasDetails ? `
                        <div id="${eventId}" class="event-details text-sm text-gray-600 font-medium leading-relaxed">
                            <p class="mb-3">${event.details}</p>
                            ${event.note ? `<p class="text-xs text-sketch-alert font-bold mb-2"><i class="fas fa-exclamation-circle mr-1"></i>${event.note}</p>` : ''}
                            <div class="flex flex-wrap gap-2 mt-2">
                                ${event.mapLink ? `<a href="${event.mapLink}" target="_blank" class="inline-flex items-center px-3 py-1 text-xs bg-sketch-snow text-sketch-ink border-2 border-sketch-ink rounded-full shadow-[2px_2px_0_0_#5E4B35] active:translate-y-1 active:shadow-none transition-all" onclick="event.stopPropagation()"><i class="fas fa-map-marked-alt mr-1"></i> 📍 看地圖</a>` : ''}
                                ${event.reviewLink ? `<a href="${event.reviewLink}" target="_blank" class="inline-flex items-center px-3 py-1 text-xs bg-sketch-warm text-sketch-ink border-2 border-sketch-ink rounded-full shadow-[2px_2px_0_0_#5E4B35] active:translate-y-1 active:shadow-none transition-all" onclick="event.stopPropagation()"><i class="fas fa-utensils mr-1"></i> 🍴 查食記</a>` : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>`;
            });

            container.innerHTML = html;
        }

        function toggleDetails(id, card) {
            const details = document.getElementById(id);
            if (!details) return;
            card.classList.toggle('expanded');
            const icon = card.querySelector('.expand-icon');
            if(icon) icon.style.transform = card.classList.contains('expanded') ? 'rotate(180deg)' : 'rotate(0)';
        }

        // Guide Logic
        function renderGuide() {
            const container = document.getElementById('guide-container');
            let html = '';
            guideData.forEach((item, index) => {
                const rotate = index % 2 === 0 ? '-rotate-1' : 'rotate-1';
                // No images, just text notes
                html += `
                <div class="sketch-box p-6 relative bg-white mb-4 transform ${rotate} hover:rotate-0 transition-transform">
                    <div class="washi-tape" style="top: -12px; right: 40%; width: 80px; background-color: rgba(168, 216, 185, 0.6);"></div>
                    <div class="flex gap-2 mb-3 flex-wrap">
                        ${item.tags.map(t => `<span class="text-[10px] font-bold text-sketch-ink bg-sketch-warm border border-sketch-ink px-2 py-1 rounded-full">${t}</span>`).join('')}
                    </div>
                    <h3 class="text-xl font-black text-sketch-ink mb-3 pb-2 border-b-2 border-dashed border-sketch-line flex items-center">
                        <span class="mr-2 text-2xl">✎</span> ${item.title}
                    </h3>
                    <div class="lined-paper p-4 rounded-lg border border-sketch-line text-sm text-sketch-ink font-medium relative shadow-inner">
                        <p>${item.content}</p>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        // Wallet Logic
        let currentPhotoBase64 = null;
        function appendCalc(val) {
             const input = document.getElementById('calc-input');
             input.value += val;
             calculate();
        }

        function clearCalc() {
            document.getElementById('calc-input').value = "";
            calculate();
        }

        function calculate() {
            const input = document.getElementById('calc-input').value;
            const rate = parseFloat(document.getElementById('exchange-rate').value) || 0.201;

            if (!input) {
                document.getElementById('calc-result-jpy').innerText = "0";
                document.getElementById('calc-result-twd').innerText = "0";
                return;
            }

            try {
                if (/^[0-9+\-*/().\s]+$/.test(input)) {
                    const jpy = new Function('return ' + input)();
                    if (isFinite(jpy)) {
                        document.getElementById('calc-result-jpy').innerText = Math.round(jpy).toLocaleString();
                        document.getElementById('calc-result-twd').innerText = Math.round(jpy * rate).toLocaleString();
                    }
                }
            } catch(e) {}
        }

        function handlePhotoUpload(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const maxSize = 300;
                        let width = img.width; let height = img.height;
                        if (width > height) { if (width > maxSize) { height *= maxSize / width; width = maxSize; } }
                        else { if (height > maxSize) { width *= maxSize / height; height = maxSize; } }
                        canvas.width = width; canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);
                        currentPhotoBase64 = canvas.toDataURL('image/jpeg', 0.6);
                        document.getElementById('photo-preview').src = currentPhotoBase64;
                        document.getElementById('photo-preview-container').classList.remove('hidden');
                    };
                    img.src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
        function clearPhoto() {
            document.getElementById('expense-photo').value = "";
            document.getElementById('photo-preview-container').classList.add('hidden');
            currentPhotoBase64 = null;
        }
        function addExpense() {
            const item = document.getElementById('expense-item').value;
            const amountStr = document.getElementById('calc-result-jpy').innerText.replace(/,/g, '');
            const amount = parseInt(amountStr) || 0;
            if(!item || amount <= 0) { alert("記得輸入金額喔！💰"); return; }
            expenses.unshift({ id: Date.now(), item: item, amount: amount, image: currentPhotoBase64, date: new Date().toLocaleDateString() });
            localStorage.setItem('expenses_book_2025', JSON.stringify(expenses));
            renderExpenses();
            document.getElementById('expense-item').value = ""; document.getElementById('calc-input').value = "";
            document.getElementById('calc-result-jpy').innerText = "0"; document.getElementById('calc-result-twd').innerText = "0"; clearPhoto();
        }
        function renderExpenses() {
            const list = document.getElementById('expense-list');
            const totalEl = document.getElementById('total-jpy');
            list.innerHTML = '';
            let total = 0; const rate = parseFloat(document.getElementById('exchange-rate').value) || 0.201;
            expenses.forEach((ex, index) => {
                total += ex.amount; const twd = Math.round(ex.amount * rate);
                const li = document.createElement('li');
                li.className = "sketch-box p-3 flex items-center gap-3 bg-white mb-2";
                li.innerHTML = `
                    ${ex.image ? `<div class="w-12 h-12 bg-gray-100 flex-shrink-0 flex items-center justify-center overflow-hidden border-2 border-sketch-ink rounded-lg"><img src="${ex.image}" class="w-full h-full object-cover" onclick="showImage('${ex.image}')"></div>` : `<div class="w-12 h-12 bg-sketch-snow flex-shrink-0 flex items-center justify-center text-sketch-ink text-xl border-2 border-sketch-ink rounded-lg"><i class="fas fa-receipt"></i></div>`}
                    <div class="flex-1 min-w-0">
                        <div class="flex justify-between items-baseline">
                            <h4 class="text-sm font-black text-sketch-ink truncate pr-2">${ex.item}</h4>
                            <span class="font-black text-base text-sketch-ink">¥${ex.amount.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between items-center mt-1">
                            <span class="text-[10px] text-gray-500 font-bold">${ex.date}</span>
                            <span class="text-[10px] text-sketch-alert font-bold">≈ NT$ ${twd.toLocaleString()}</span>
                        </div>
                    </div>
                    <button onclick="deleteExpense(${index})" class="text-gray-400 hover:text-sketch-alert px-2"><i class="fas fa-trash-alt"></i></button>
                `;
                list.appendChild(li);
            });
            totalEl.innerText = total.toLocaleString();
        }
        function deleteExpense(index) { if(confirm("要撕掉這頁紀錄嗎？")) { expenses.splice(index, 1); localStorage.setItem('expenses_book_2025', JSON.stringify(expenses)); renderExpenses(); } }
        function clearExpenses() { if(confirm("確定要換新帳本嗎？(清空)")) { expenses = []; localStorage.setItem('expenses_book_2025', JSON.stringify(expenses)); renderExpenses(); } }

        // List Logic
        function renderTodoList() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = '';
            todoList.forEach((todo, index) => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-3 bg-white p-2 rounded border-b-2 border-sketch-line border-dashed";
                div.innerHTML = `
                    <input type="checkbox" class="w-5 h-5 accent-sketch-ink cursor-pointer" ${todo.done ? 'checked' : ''} onchange="toggleTodo(${index})">
                    <span class="text-sm font-bold text-sketch-ink flex-1 ${todo.done ? 'line-through text-gray-400 decoration-wavy' : ''}">${todo.text}</span>
                    <button onclick="removeTodo(${index})" class="text-gray-300 hover:text-sketch-alert"><i class="fas fa-times"></i></button>
                `;
                container.appendChild(div);
            });
        }
        function toggleTodo(index) { todoList[index].done = !todoList[index].done; saveTodo(); }
        function addTodo() { const input = document.getElementById('new-todo'); const text = input.value.trim(); if(text) { todoList.push({ text: text, done: false }); saveTodo(); input.value = ''; } }
        function removeTodo(index) { todoList.splice(index, 1); saveTodo(); }
        function saveTodo() { localStorage.setItem('todo_book_2025', JSON.stringify(todoList)); renderTodoList(); }

        function showImage(src) {
            const overlay = document.createElement('div');
            overlay.className = "fixed inset-0 bg-sketch-ink/80 z-50 flex items-center justify-center p-6 backdrop-blur-sm";
            overlay.onclick = () => overlay.remove();
            overlay.innerHTML = `<div class="bg-white p-2 border-4 border-sketch-ink rounded-lg rotate-1"><img src="${src}" class="max-w-full max-h-full rounded"></div>`;
            document.body.appendChild(overlay);
        }
    </script>

    <script async id="netlify-rum-container" src="/.netlify/scripts/rum" data-netlify-rum-site-id="8003cbaf-be09-421b-b701-0774be002038" data-netlify-deploy-branch="" data-netlify-deploy-context="production" data-netlify-cwv-token="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzaXRlX2lkIjoiODAwM2NiYWYtYmUwOS00MjFiLWI3MDEtMDc3NGJlMDAyMDM4IiwiYWNjb3VudF9pZCI6IjY5MjQxMmFmYmM2NjQ5ZTZkOGQ5ZjdiZiIsImRlcGxveV9pZCI6IjY5MmMzNGEzYzJhZWEyNDAzNTZhMGFhOCIsImlzc3VlciI6Im5mc2VydmVyIn0.UhAsomSKHNugC7L5rmD9_eew9li4gC5vSL6bxT6_lLs"></script>
</body>
</html>